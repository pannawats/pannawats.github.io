<!DOCTYPE html>
<html>
<head>
    <title>Thai Death Pathways</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap');
        
        body { 
            background: #000; 
            margin: 0; 
            overflow: hidden;
            font-family: 'Inter', sans-serif;
        }
        .node { stroke: #333; stroke-width: 1.5px; cursor: pointer; }
        .link { stroke: #666; stroke-opacity: 0.6; }
        text { 
            font-family: 'Inter', sans-serif; 
            font-size: 10px; 
            fill: #fff;
            pointer-events: none;
        }
        .legend {
            position: absolute;
            left: 20px;
            top: 20px;
            background: rgba(30,30,30,0.9);
            padding: 15px;
            border-radius: 8px;
            color: white;
            border: 1px solid #444;
        }
    </style>
</head>
<body>
    <div class="legend">
        <div style="color:#ff6b6b">â–  Death Types</div>
        <div style="color:#4ecdc4">â–  Spirit World</div>
        <div style="color:#ffe66d">â–  Real World</div>
        <div style="color:#ff9ff3">â–  Transition Points</div>
    </div>
    <svg width="1200" height="800"></svg>

<script>
// INITIALIZATION ==============================================
const svg = d3.select("svg");
const width = 1200;
const height = 800;

// DATA ========================================================
const nodes = [
    {id: "ðŸ’€ Death", group: 0, size: 28},
    {id: "ðŸ”ª Murder", group: 1},
    {id: "ðŸŒ¿ Natural Death", group: 1},
    {id: "ðŸ’¥ Sudden Death", group: 1},
    {id: "ðŸ’” Suicide", group: 1},
    {id: "ðŸ¥ Hospital Death", group: 1},
    {id: "ðŸ‘» Phi Tai Hong", group: 2},
    {id: "ðŸ•¯ï¸ Home Altar Spirit", group: 2},
    {id: "ðŸŒ€ Restless Ghost", group: 2},
    {id: "â™¾ï¸ Karmic Loop", group: 2},
    {id: "ðŸ¥ Hospital Spirit", group: 2},
    {id: "ðŸ”„ Replacement Rituals", group: 2},
    {id: "ðŸ“œ Merit Rituals", group: 2},
    {id: "âš–ï¸ Judgment", group: 2},
    {id: "ðŸŒŸ Rebirth", group: 2},
    {id: "ðŸ”¥ Hell Rebirth", group: 2},
    {id: "ðŸš‘ Police Morgue", group: 3},
    {id: "ðŸ• Temple", group: 3},
    {id: "âš°ï¸ Cremation", group: 3},
    {id: "ðŸ›ï¸ University Donation", group: 3},
    {id: "ðŸ‘‘ Royal Cremation", group: 3},
    {id: "49 Days", group: 4},
    {id: "Suep Winyan", group: 4}
];

const links = [
    {source: "ðŸ’€ Death", target: "ðŸ”ª Murder"},
    {source: "ðŸ’€ Death", target: "ðŸŒ¿ Natural Death"},
    {source: "ðŸ’€ Death", target: "ðŸ’¥ Sudden Death"},
    {source: "ðŸ’€ Death", target: "ðŸ’” Suicide"},
    {source: "ðŸ’€ Death", target: "ðŸ¥ Hospital Death"},
    {source: "ðŸ”ª Murder", target: "ðŸ‘» Phi Tai Hong"},
    {source: "ðŸ‘» Phi Tai Hong", target: "ðŸ”„ Replacement Rituals"},
    {source: "ðŸ”„ Replacement Rituals", target: "âš–ï¸ Judgment"},
    {source: "âš–ï¸ Judgment", target: "ðŸ”¥ Hell Rebirth"},
    {source: "ðŸ”ª Murder", target: "ðŸš‘ Police Morgue"},
    {source: "ðŸš‘ Police Morgue", target: "ðŸ• Temple"},
    {source: "ðŸ• Temple", target: "âš°ï¸ Cremation"},
    {source: "ðŸŒ¿ Natural Death", target: "ðŸ•¯ï¸ Home Altar Spirit"},
    {source: "ðŸ•¯ï¸ Home Altar Spirit", target: "49 Days"},
    {source: "49 Days", target: "ðŸ“œ Merit Rituals"},
    {source: "ðŸ“œ Merit Rituals", target: "âš–ï¸ Judgment"},
    {source: "âš–ï¸ Judgment", target: "ðŸŒŸ Rebirth"},
    {source: "ðŸŒ¿ Natural Death", target: "ðŸ• Temple"},
    {source: "ðŸ• Temple", target: "âš°ï¸ Cremation"},
    {source: "ðŸ’¥ Sudden Death", target: "ðŸŒ€ Restless Ghost"},
    {source: "ðŸŒ€ Restless Ghost", target: "ðŸ”„ Replacement Rituals"},
    {source: "ðŸ”„ Replacement Rituals", target: "âš–ï¸ Judgment"},
    {source: "âš–ï¸ Judgment", target: "ðŸ”¥ Hell Rebirth"},
    {source: "ðŸ’¥ Sudden Death", target: "ðŸš‘ Police Morgue"},
    {source: "ðŸš‘ Police Morgue", target: "ðŸ• Temple"},
    {source: "ðŸ’” Suicide", target: "â™¾ï¸ Karmic Loop"},
    {source: "â™¾ï¸ Karmic Loop", target: "ðŸ“œ Merit Rituals"},
    {source: "ðŸ“œ Merit Rituals", target: "âš–ï¸ Judgment"},
    {source: "âš–ï¸ Judgment", target: "â›“ï¸ Hell Rebirth"},
    {source: "ðŸ’” Suicide", target: "ðŸš‘ Police Morgue"},
    {source: "ðŸ¥ Hospital Death", target: "ðŸ¥ Hospital Spirit"},
    {source: "ðŸ¥ Hospital Spirit", target: "Suep Winyan"},
    {source: "Suep Winyan", target: "âš–ï¸ Judgment"},
    {source: "âš–ï¸ Judgment", target: "ðŸŒŸ Rebirth"},
    {source: "ðŸ¥ Hospital Death", target: "ðŸ›ï¸ University Donation"},
    {source: "ðŸ›ï¸ University Donation", target: "âš°ï¸ Cremation"}
];

// SIMULATION ==================================================
const simulation = d3.forceSimulation(nodes)
    .force("link", d3.forceLink(links).id(d => d.id).distance(100))
    .force("charge", d3.forceManyBody().strength(-200))
    .force("center", d3.forceCenter(width/2, height/2))
    .force("collision", d3.forceCollide().radius(d => d.size || 12))
    .alphaDecay(0.02)
    .alpha(0.5)
    .restart();

// DRAW ELEMENTS ===============================================
const link = svg.append("g")
    .selectAll("line")
    .data(links)
    .join("line")
    .attr("class", "link")
    .attr("stroke-width", 2);

const node = svg.append("g")
    .selectAll("circle")
    .data(nodes)
    .join("circle")
    .attr("class", "node")
    .attr("r", d => d.size || 10)
    .attr("fill", d => ["#fff","#ff6b6b","#4ecdc4","#ffe66d","#ff9ff3"][d.group])
    .call(d3.drag()
        .on("start", dragstarted)
        .on("drag", dragged)
        .on("end", dragended));

const label = svg.append("g")
    .selectAll("text")
    .data(nodes)
    .join("text")
    .text(d => d.id)
    .attr("font-size", d => d.size ? "14px" : "10px")
    .attr("dx", d => d.size ? 18 : 12)
    .attr("dy", "0.35em");

// UPDATE CYCLE ================================================
simulation.on("tick", () => {
    link
        .attr("x1", d => d.source.x)
        .attr("y1", d => d.source.y)
        .attr("x2", d => d.target.x)
        .attr("y2", d => d.target.y);

    node
        .attr("cx", d => d.x)
        .attr("cy", d => d.y);

    label
        .attr("x", d => d.x)
        .attr("y", d => d.y);
});

// DRAG HANDLERS ===============================================
function dragstarted(event, d) {
    if (!event.active) simulation.alphaTarget(0.3).restart();
    d.fx = d.x;
    d.fy = d.y;
}

function dragged(event, d) {
    d.fx = event.x;
    d.fy = event.y;
}

function dragended(event, d) {
    if (!event.active) simulation.alphaTarget(0);
    d.fx = null;
    d.fy = null;
}

// ZOOM HANDLER ================================================
svg.call(d3.zoom()
    .scaleExtent([0.5, 4])
    .on("zoom", (event) => {
        node.attr("transform", event.transform);
        link.attr("transform", event.transform);
        label.attr("transform", event.transform);
    }));
</script>
</body>
</html>
