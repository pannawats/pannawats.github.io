<!DOCTYPE html>
<html>
<head>
    <title>Thai Death Pathways</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap');
        
        body { 
            background: #000; 
            margin: 0; 
            overflow: hidden;
            font-family: 'Inter', sans-serif;
        }
        .node { stroke: #333; stroke-width: 1.5px; cursor: pointer; }
        .link { stroke: #666; stroke-opacity: 0.6; }
        text { 
            font-family: 'Inter', sans-serif; 
            font-size: 10px; 
            fill: #fff;
            pointer-events: none;
        }
        .legend {
            position: absolute;
            left: 20px;
            top: 20px;
            background: rgba(30,30,30,0.9);
            padding: 15px;
            border-radius: 8px;
            color: white;
            border: 1px solid #444;
        }
    </style>
</head>
<body>
    <div class="legend">
        <div style="color:#ff6b6b">■ Death Types</div>
        <div style="color:#4ecdc4">■ Spirit World</div>
        <div style="color:#ffe66d">■ Real World</div>
        <div style="color:#ff9ff3">■ Transition Points</div>
    </div>
    <svg width="1200" height="800"></svg>

<script>
// INITIALIZATION ==============================================
const svg = d3.select("svg");
const width = 1200;
const height = 800;

// DATA ========================================================
const nodes = [
    {id: "💀 Death", group: 0, size: 28},
    {id: "🔪 Murder", group: 1},
    {id: "🌿 Natural Death", group: 1},
    {id: "💥 Sudden Death", group: 1},
    {id: "💔 Suicide", group: 1},
    {id: "🏥 Hospital Death", group: 1},
    {id: "👻 Phi Tai Hong", group: 2},
    {id: "🕯️ Home Altar Spirit", group: 2},
    {id: "🌀 Restless Ghost", group: 2},
    {id: "♾️ Karmic Loop", group: 2},
    {id: "🏥 Hospital Spirit", group: 2},
    {id: "🔄 Replacement Rituals", group: 2},
    {id: "📜 Merit Rituals", group: 2},
    {id: "⚖️ Judgment", group: 2},
    {id: "🌟 Rebirth", group: 2},
    {id: "🔥 Hell Rebirth", group: 2},
    {id: "🚑 Police Morgue", group: 3},
    {id: "🕍 Temple", group: 3},
    {id: "⚰️ Cremation", group: 3},
    {id: "🏛️ University Donation", group: 3},
    {id: "👑 Royal Cremation", group: 3},
    {id: "49 Days", group: 4},
    {id: "Suep Winyan", group: 4}
];

const links = [
    {source: "💀 Death", target: "🔪 Murder"},
    {source: "💀 Death", target: "🌿 Natural Death"},
    {source: "💀 Death", target: "💥 Sudden Death"},
    {source: "💀 Death", target: "💔 Suicide"},
    {source: "💀 Death", target: "🏥 Hospital Death"},
    {source: "🔪 Murder", target: "👻 Phi Tai Hong"},
    {source: "👻 Phi Tai Hong", target: "🔄 Replacement Rituals"},
    {source: "🔄 Replacement Rituals", target: "⚖️ Judgment"},
    {source: "⚖️ Judgment", target: "🔥 Hell Rebirth"},
    {source: "🔪 Murder", target: "🚑 Police Morgue"},
    {source: "🚑 Police Morgue", target: "🕍 Temple"},
    {source: "🕍 Temple", target: "⚰️ Cremation"},
    {source: "🌿 Natural Death", target: "🕯️ Home Altar Spirit"},
    {source: "🕯️ Home Altar Spirit", target: "49 Days"},
    {source: "49 Days", target: "📜 Merit Rituals"},
    {source: "📜 Merit Rituals", target: "⚖️ Judgment"},
    {source: "⚖️ Judgment", target: "🌟 Rebirth"},
    {source: "🌿 Natural Death", target: "🕍 Temple"},
    {source: "🕍 Temple", target: "⚰️ Cremation"},
    {source: "💥 Sudden Death", target: "🌀 Restless Ghost"},
    {source: "🌀 Restless Ghost", target: "🔄 Replacement Rituals"},
    {source: "🔄 Replacement Rituals", target: "⚖️ Judgment"},
    {source: "⚖️ Judgment", target: "🔥 Hell Rebirth"},
    {source: "💥 Sudden Death", target: "🚑 Police Morgue"},
    {source: "🚑 Police Morgue", target: "🕍 Temple"},
    {source: "💔 Suicide", target: "♾️ Karmic Loop"},
    {source: "♾️ Karmic Loop", target: "📜 Merit Rituals"},
    {source: "📜 Merit Rituals", target: "⚖️ Judgment"},
    {source: "⚖️ Judgment", target: "⛓️ Hell Rebirth"},
    {source: "💔 Suicide", target: "🚑 Police Morgue"},
    {source: "🏥 Hospital Death", target: "🏥 Hospital Spirit"},
    {source: "🏥 Hospital Spirit", target: "Suep Winyan"},
    {source: "Suep Winyan", target: "⚖️ Judgment"},
    {source: "⚖️ Judgment", target: "🌟 Rebirth"},
    {source: "🏥 Hospital Death", target: "🏛️ University Donation"},
    {source: "🏛️ University Donation", target: "⚰️ Cremation"}
];

// SIMULATION ==================================================
const simulation = d3.forceSimulation(nodes)
    .force("link", d3.forceLink(links).id(d => d.id).distance(100))
    .force("charge", d3.forceManyBody().strength(-200))
    .force("center", d3.forceCenter(width/2, height/2))
    .force("collision", d3.forceCollide().radius(d => d.size || 12))
    .alphaDecay(0.02)
    .alpha(0.5)
    .restart();

// DRAW ELEMENTS ===============================================
const link = svg.append("g")
    .selectAll("line")
    .data(links)
    .join("line")
    .attr("class", "link")
    .attr("stroke-width", 2);

const node = svg.append("g")
    .selectAll("circle")
    .data(nodes)
    .join("circle")
    .attr("class", "node")
    .attr("r", d => d.size || 10)
    .attr("fill", d => ["#fff","#ff6b6b","#4ecdc4","#ffe66d","#ff9ff3"][d.group])
    .call(d3.drag()
        .on("start", dragstarted)
        .on("drag", dragged)
        .on("end", dragended));

const label = svg.append("g")
    .selectAll("text")
    .data(nodes)
    .join("text")
    .text(d => d.id)
    .attr("font-size", d => d.size ? "14px" : "10px")
    .attr("dx", d => d.size ? 18 : 12)
    .attr("dy", "0.35em");

// UPDATE CYCLE ================================================
simulation.on("tick", () => {
    link
        .attr("x1", d => d.source.x)
        .attr("y1", d => d.source.y)
        .attr("x2", d => d.target.x)
        .attr("y2", d => d.target.y);

    node
        .attr("cx", d => d.x)
        .attr("cy", d => d.y);

    label
        .attr("x", d => d.x)
        .attr("y", d => d.y);
});

// DRAG HANDLERS ===============================================
function dragstarted(event, d) {
    if (!event.active) simulation.alphaTarget(0.3).restart();
    d.fx = d.x;
    d.fy = d.y;
}

function dragged(event, d) {
    d.fx = event.x;
    d.fy = event.y;
}

function dragended(event, d) {
    if (!event.active) simulation.alphaTarget(0);
    d.fx = null;
    d.fy = null;
}

// ZOOM HANDLER ================================================
svg.call(d3.zoom()
    .scaleExtent([0.5, 4])
    .on("zoom", (event) => {
        node.attr("transform", event.transform);
        link.attr("transform", event.transform);
        label.attr("transform", event.transform);
    }));
</script>
</body>
</html>
